# 3.3 SPC(통계적 공정 관리) — 공정 안정성의 파수꾼

## 이 챕터에서 배우는 것
- SPC(Statistical Process Control)의 기본 개념과 목적
- 관리도(Control Chart)의 원리와 종류
- 관리 한계(Control Limit) vs 규격 한계(Spec Limit)
- 웨스턴 일렉트릭 규칙(Western Electric Rules) — 이상 패턴 탐지
- Cp, Cpk — 공정 능력 지수
- AI 시대의 SPC — 전통 통계에서 지능형 모니터링으로

---

## SPC란: 100년 전의 통찰이 지금도 유효한 이유

이전 두 챕터에서 수율의 경제적 의미(3.1)와 결함을 찾아 분류하는 방법(3.2)을 다뤘다. 이제 질문이 바뀐다 — 결함이 **발생하기 전에** 공정의 이상을 감지할 수는 없는가?

**SPC(Statistical Process Control, 통계적 공정 관리)**가 이 질문에 답한다. SPC는 공정의 출력값(CD, Overlay, 막 두께, 결함 수 등)을 **시간 순서로 모니터링**하여, 공정이 **안정 상태(In-Control)**를 유지하고 있는지 실시간으로 감시하는 통계적 방법이다.

1920년대 Walter Shewhart가 Bell Labs에서 전화기 제조 품질을 관리하기 위해 **관리도(Control Chart)**를 발명한 것이 SPC의 시작이다. 거의 100년이 지난 지금, 세계에서 가장 첨단인 3nm 반도체 팹에서도 Shewhart의 관리도가 여전히 매일 수만 번 사용되고 있다. 기본 원리가 그만큼 보편적이고 강건하기 때문이다.

여러분에게 익숙한 비유를 들자면, SPC는 **시스템 모니터링 대시보드(Grafana, Datadog, Prometheus)**와 같다. CPU 사용률, 메모리, 응답 시간, 에러율을 실시간으로 모니터링하고, 정상 범위를 넘으면 알람을 발생시켜 장애를 조기에 감지한다. SPC는 이것의 **제조 공정 버전**이다. "서버 응답 시간"이 "CD 측정값"으로, "CPU 사용률"이 "PEB 온도"로 바뀐 것뿐이다.

---

## 관리도: SPC의 핵심 도구

### 기본 구조

관리도는 시간 축(x)에 측정값(y)을 점으로 찍어가며, 세 개의 수평선과 함께 보여주는 차트다.

```
UCL ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  (상한 관리 한계)
     ·    ·  ·
CL  ─·──·──·──·──·──·──·──·──·──  (중심선 = 평균)
        ·       ·  ·     ·
LCL ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─  (하한 관리 한계)

    시간/로트/웨이퍼 →
```

**CL(Center Line)**은 공정의 평균값(μ)이다. 정상 상태에서 측정값이 이 선 주변에 모여야 한다. **UCL(Upper Control Limit)**은 μ + 3σ, **LCL(Lower Control Limit)**은 μ - 3σ이다. 정상 분포에서 데이터의 99.73%가 μ ± 3σ 안에 들어오므로, 이 한계를 벗어나는 점은 **0.27%의 확률** — 즉 정상적 변동으로는 거의 발생하지 않는 사건이다. 이런 점이 나타나면 공정에 **이상이 생겼을 가능성이 높다**고 판단한다.

### 관리 한계와 규격 한계: 절대 혼동하면 안 되는 개념


![관리 한계(Control Limit) vs 규격 한계(Spec Limit) 개념도](https://image-proxy.jenghun-suh.workers.dev/images/03_03/control_vs_spec_limits.svg)

이 둘의 구분은 SPC의 가장 중요한 개념적 기초이며, 혼동하면 치명적 실수를 한다.

**관리 한계(Control Limit, UCL/LCL)**는 공정 데이터에서 **산출**되는 값이다. 공정의 자연적 변동 범위(μ ± 3σ)를 나타내며, "공정이 정상인가?"를 판단하는 기준이다. 관리 한계를 벗어나면 공정에 이상이 생겼다는 신호이므로 **조사가 필요**하다.

**규격 한계(Spec Limit, USL/LSL)**는 설계나 고객이 **정하는** 값이다. 제품이 만족해야 하는 허용 범위를 나타내며, "제품이 양품인가?"를 판단하는 기준이다. 규격 한계를 벗어나면 **제품이 불량**이므로 폐기하거나 재작업해야 한다.

이상적인 공정 상태는 **관리 한계가 규격 한계 안에 충분한 여유를 가지고 들어오는** 것이다. 이러면 공정이 관리 한계 내에 있는 한 — 즉 정상적으로 작동하는 한 — 규격 불량이 발생하지 않는다. 반대로 관리 한계가 규격 한계에 가깝거나 넘어서면, 공정이 "정상"이어도 불량이 발생하는 위험한 상태다.

---

## 이상 패턴 탐지: 관리 한계 안에서도 문제를 잡는다

### Western Electric (WECO) Rules


![WECO Rules — SPC 이상 패턴 4종 시각화](https://image-proxy.jenghun-suh.workers.dev/images/03_03/weco_rules_patterns.svg)

단순히 "3σ를 넘었는가?"만 보면 많은 이상을 놓친다. 관리 한계 안에 있더라도 **체계적인 패턴**이 나타나면, 그것은 공정에 무언가가 변하고 있다는 증거다. 1950년대 Western Electric Company가 정리한 **WECO Rules**가 이 패턴 탐지의 표준이다.

**Rule 1 — 3σ 이탈**: 1개 점이 UCL 또는 LCL을 벗어남. 가장 확실한 이상 신호.

**Rule 2 — 2σ 경고**: 연속 3개 중 2개가 같은 쪽의 2σ~3σ 사이에 위치. 아직 3σ는 넘지 않았지만, 확률적으로 매우 드문 사건이다.

**Rule 3 — 1σ 추세**: 연속 5개 중 4개가 같은 쪽의 1σ 밖에 위치. 평균이 한쪽으로 서서히 이동(Drift)하고 있을 가능성.

**Rule 4 — 평균 이동(Shift)**: 연속 8개가 CL의 같은 쪽(위 또는 아래)에 위치. 정상이라면 CL 위와 아래에 거의 반반으로 분포해야 하므로, 8개 연속으로 한쪽에 있을 확률은 (1/2)⁸ = 0.4%로 매우 낮다. 평균이 이동한 것으로 판단한다.

이 규칙들을 Grafana의 알람 규칙과 대응시키면 직관적이다. Rule 1은 **Critical Alert**(임계값 초과), Rule 4는 **Trend Alert**(지속적 변화), Rule 2, 3은 **Warning Alert**(경계 상태)에 해당한다.

추가로 연속 6개 이상이 단조 증가/감소하면 **Trend(추세)** — 장비가 서서히 열화되거나 소모품이 마모되는 신호다. 점들이 교대로 위아래를 반복하면 **Oscillation(진동)** — 두 장비가 번갈아 사용되거나 제어 시스템이 과보정(Over-correction)하는 징후다.

---

## 공정 능력 지수: 공정이 규격을 얼마나 여유 있게 만족하는가

### Cp — 잠재적 능력

**Cp(Process Capability)**는 규격 폭 대비 공정 변동의 비율이다.

```
Cp = (USL - LSL) / (6σ)
```

6σ는 공정 변동의 "폭"(±3σ)이므로, Cp = 1.0이면 공정 변동과 규격 폭이 정확히 같아 **여유가 전혀 없다**. Cp = 2.0이면 공정 변동이 규격 폭의 절반이므로 양쪽에 **3σ씩의 마진**이 있다.

### Cpk — 실제 능력


![Cp vs Cpk 차이 시각화 — 공정 능력 지수 비교](https://image-proxy.jenghun-suh.workers.dev/images/03_03/cp_vs_cpk_visualization.png)

**Cpk**는 Cp에 **평균의 치우침(Centering)**을 반영한 것이다.

```
Cpk = min((USL - μ) / 3σ, (μ - LSL) / 3σ)
```

Cpk가 Cp보다 항상 같거나 작다. 평균이 규격 중심에 정확히 있으면 Cpk = Cp이고, 한쪽으로 치우칠수록 Cpk가 Cp보다 작아진다. Cpk가 작다는 것은 "공정 변동은 작지만 평균이 치우쳐 있어 한쪽 규격 한계에 가깝다"는 의미이며, 약간의 드리프트만으로도 규격 이탈이 발생할 위험이 있다.

구체적 예로 보자. 3nm 공정에서 CD 규격이 목표값 ±2nm(USL - LSL = 4nm)이고 3σ가 1.5nm(σ = 0.5nm)이면, Cp = 4 / (6 × 0.5) = **1.33**으로 최소 요구를 간신히 충족한다. 만약 평균이 목표에서 0.5nm 치우쳐 있으면, Cpk = min((2-0.5)/1.5, (2+0.5)/1.5) = min(1.0, 1.67) = **1.0** — 최소 요구(1.33)를 불만족한다. 평균의 치우침을 보정(2.10장의 APC Feedback)하면 Cpk를 Cp 수준으로 올릴 수 있다.

반도체에서의 목표는 Cp ≥ 2.0, Cpk ≥ 1.67이다. 이 수준이면 공정이 정상적으로 작동하는 한 규격 불량이 사실상 발생하지 않는다(6σ 수준의 품질).

---

## 반도체 SPC의 특수성: 교과서와 현실의 차이


![다변량 SPC — PCA 기반 T² 관리도](https://image-proxy.jenghun-suh.workers.dev/images/03_03/multivariate_spc_t2_chart.png)

일반 제조업의 SPC 교과서와 반도체 팹의 현실 사이에는 몇 가지 중요한 차이가 있다.

**다변량(Multivariate) 문제** — 반도체 공정은 수백~수천 개의 파라미터를 동시에 모니터링한다. 각 파라미터의 개별 SPC 차트(단변량)만으로는 **파라미터 간 상관관계**에 의한 이상을 놓칠 수 있다. 예를 들어 파라미터 A와 B가 각각 관리 한계 내에 있지만, A와 B의 조합이 비정상적 영역에 있을 수 있다. 다변량 SPC — Hotelling's T², PCA 기반 T²/Q 통계량 — 가 이 문제를 다루며, 이것이 3.4장의 FDC와 직접 연결된다.

**비정규 분포** — SPC의 μ ± 3σ 관리 한계는 정규분포를 전제로 한다. 하지만 반도체 계측 데이터 중 상당수가 정규분포를 따르지 않는다. 결함 수는 포아송 분포, 수율은 이항/베타 분포, CD는 약간의 비대칭(Skew)을 보일 수 있다. 비정규 데이터에 μ ± 3σ를 적용하면 False Alarm이 과다하거나 진짜 이상을 놓칠 수 있다. 데이터 변환(Box-Cox)이나 비모수적 관리 한계가 필요하다.

**소량 다품종** — 최첨단 팹에서는 다양한 제품이 동시에 흐른다. 제품마다 공정 조건(레시피)이 다르므로 CD 목표값, 정상 범위가 다르다. 한 SPC 차트로 모든 제품을 관리하면 False Alarm이 폭증한다. 제품/레시피별로 SPC를 분리하거나, **잔차(Residual) 기반 SPC** — 모델이 예측한 값과 실제값의 차이를 모니터링 — 로 제품 효과를 제거한 후 모니터링하는 접근이 필요하다.

---

## AI 시대의 SPC: 100년의 한계를 넘다

### 전통 SPC의 구조적 한계

전통 SPC는 100년간 효과적이었지만, 현대 반도체 공정의 복잡도에서 구조적 한계가 드러난다. **단변량 중심** 설계로 파라미터 간 상호작용을 반영하지 못하고, 관리 한계가 **고정**되어 공정 변화에 느리게 적응한다. **사후 탐지** 방식으로 이미 이탈이 발생한 후에야 알리며(예측이 아닌 탐지), 수천 개 파라미터에 WECO 규칙을 적용하면 **False Alarm이 과다**해져 엔지니어가 "Alarm Fatigue(알람 피로)"에 빠진다.

### AI 기반 지능형 모니터링

AI는 이 한계들을 체계적으로 극복한다.

**다변량 이상 탐지** — PCA, Autoencoder, Isolation Forest 등으로 수백 변수를 동시에 모니터링하여, 단변량으로는 잡지 못하는 미묘한 이상 패턴(변수 간 상관 구조의 변화)을 탐지한다.

**동적 관리 한계** — 공정 조건(제품, 장비, 시즌, PM 후 경과 시간)에 따라 관리 한계를 자동 조정한다. Context를 반영함으로써 False Alarm을 줄이고 진짜 이상의 탐지율을 높인다.

**예측적 모니터링** — 현재까지의 추세를 분석하여 **미래의 이탈을 사전 예측**한다. "지금은 관리 한계 내이지만, 현재 Drift 속도로 3시간 후 UCL을 넘을 것"이라는 예측이 가능하면, 사후 대응이 아닌 **사전 대응**이 된다.

**Root Cause 자동 추정** — OOC가 발생하면, 같은 시간대에 어떤 장비가 사용되었는지, 어떤 재료 배치가 투입되었는지, 다른 파라미터에도 변화가 있었는지를 자동으로 상관분석하여 원인 후보를 제시한다.

---

## 핵심 정리

SPC(Statistical Process Control)는 **관리도(Control Chart)**로 공정의 측정값을 시간순으로 모니터링하여 이상을 조기에 감지하는 통계적 방법이며, 관리 한계(μ±3σ, 공정 데이터 기반)와 규격 한계(설계 요구)를 **절대 혼동하면 안 된다**. **WECO Rules**는 3σ 이탈뿐 아니라 추세(Trend), 평균 이동(Shift), 진동(Oscillation) 등 관리 한계 내의 체계적 패턴도 탐지한다. **Cp/Cpk**는 공정 능력 지수로, 반도체에서는 Cp ≥ 2.0, Cpk ≥ 1.67을 목표로 한다. 반도체 SPC의 특수성(다변량, 비정규, 소량 다품종)은 전통 SPC의 한계를 드러내며, AI 기반 지능형 모니터링 — **다변량 이상 탐지, 동적 관리 한계, 예측적 모니터링, Root Cause 자동 추정** — 이 이 한계를 넘어서고 있다.

---

*다음 챕터: 3.4 FDC(결함 탐지와 분류) — 장비 레벨 감시*
