# 3.9 반도체 데이터의 특성 — 시계열, 공간, 계층 구조

## 이 챕터에서 배우는 것
- 반도체 데이터가 일반 산업 데이터와 다른 고유한 특성
- 시계열 구조 — 로트 간, 웨이퍼 간, 공정 스텝 간
- 공간 구조 — 웨이퍼 내, 필드 내, 다이 내
- 계층 구조 — 팹 → 장비 → 챔버 → 로트 → 웨이퍼 → 다이
- 반도체 데이터에 적합한 ML 접근법
- SMILE 플랫폼 개발 시 고려할 데이터 모델링 원칙

---

## 반도체 데이터는 왜 특별한가: 세 겹의 구조

Part 3의 마지막 챕터다. 앞 여덟 챕터에서 수율, 결함, SPC, FDC, APC, VM, 웨이퍼맵, 데이터 인프라를 다루면서, 반도체 공정 데이터가 단순한 정형 테이블(Tabular Data)이 아니라는 것을 곳곳에서 느꼈을 것이다. 이 챕터에서는 그 **"왜 다른지"**를 체계적으로 정리한다.

반도체 공정 데이터는 세 가지 구조가 **동시에 중첩**된 다중 구조(Multi-Structure) 데이터다. 시간에 따른 변화를 담은 **시계열(Temporal)**, 웨이퍼 위의 위치에 따른 변화를 담은 **공간(Spatial)**, 팹-장비-웨이퍼-다이의 중첩을 반영하는 **계층(Hierarchical)** 구조가 그것이다.

이 세 구조를 무시하고 데이터를 단순히 (Wafer_ID, Feature_1, Feature_2, ..., Target)의 플랫 테이블로 펼치면, **구조에 담긴 정보가 손실**된다. 예를 들어, 같은 장비에서 연속으로 처리된 웨이퍼들 사이의 시간적 상관(장비 Drift), 웨이퍼 중심과 가장자리의 공간적 차이(코팅 불균일), 장비 A와 B의 체계적 차이(계층 효과)가 플랫 테이블에서는 사라지거나 노이즈로 전락한다.

이 구조를 이해하고 모델에 반영하는 것이 반도체 AI의 차별화 지점이다.

---

## 시계열 구조: 다섯 가지 시간 스케일이 동시에 작동한다


![시공간 결합 데이터 큐브 (시간 × X × Y)](/content/images/03_09/spatiotemporal_data_cube.svg)

반도체 데이터의 시간적 변동은 **여러 스케일**에서 동시에 발생한다. 이것이 일반적인 시계열 문제와 다른 핵심 특성이다.

**밀리초~초 스케일** — 3.4장의 FDC Trace가 이 스케일이다. 플라즈마의 RF 전력 변동, 노광 중 스캐너의 Focus 제어, 가스 유량의 순간적 변동이 여기에 해당한다. CNN이나 LSTM이 이 패턴을 포착한다.

**분~시간 스케일** — 같은 장비에서 연속으로 처리되는 웨이퍼 간의 변동이다. 장비의 열 축적(시간이 지나면 챔버 온도가 서서히 올라간다), 소모품의 점진적 열화가 원인이다. 3.5장의 EWMA가 이 스케일의 Drift를 추적한다.

**시간~일 스케일** — PM(예방 보전) 주기가 이 스케일이다. PM 직후 장비 상태가 리셋되고, 다음 PM까지 서서히 열화한다. 3.4장의 Predictive Maintenance가 이 패턴을 모델링한다.

**일~주 스케일** — 소재(레지스트, 가스) 배치 변경이 이 스케일에서 영향을 미친다. 새 레지스트 로트가 투입되면 감광 특성이 미세하게 달라져 CD가 시프트할 수 있다.

**월~분기 스케일** — 계절 변동이다. 클린룸의 온습도가 여름과 겨울에 미세하게 다르고, 이것이 코팅 두께나 현상 속도에 영향을 미친다. 장기 회귀 모델에 환경 변수를 포함하여 대응한다.

핵심 도전은 이 다섯 스케일의 변동이 **동시에 중첩**된다는 것이다. 관측된 CD 값에는 밀리초 스케일의 노이즈, 시간 스케일의 장비 Drift, 일 스케일의 소재 배치 효과, 월 스케일의 계절 변동이 **모두 섞여 있다**. 이 성분들을 분리하지 않으면, 짧은 기간의 데이터로 학습한 모델이 장기 변동을 놓치고, 장기 데이터로 학습한 모델이 단기 이상에 둔감해진다.

### 비정상성(Non-Stationarity)이라는 근본 문제

반도체 공정은 **끊임없이 변한다**. PM, 부품 교체, 레시피 변경, 새 제품 도입, 소재 배치 변경... 데이터의 통계적 특성(평균, 분산, 상관 구조)이 시간에 따라 변하는 **비정상(Non-Stationary)** 프로세스다. 정적 모델(한 번 학습하고 고정)은 빠르게 열화한다 — 3.6장에서 VM의 Model Degradation으로 이 문제를 다뤘다.

대응 전략은 세 가지다. EWMA 기반 파라미터 업데이트나 Online Learning으로 모델을 지속적으로 적응시키는 **적응형 모델**, PM 이후 웨이퍼 수, 장비 가동 시간, 소재 배치 ID 등을 피처에 포함하여 변화의 원인을 명시적으로 인코딩하는 **Context 피처**, 공정의 통계적 특성이 급변하는 시점(PM, 장비 이상 등)을 자동 감지하여 모델을 리셋하거나 재학습하는 **Change Point Detection**이다.

---

## 공간 구조: 네 가지 공간 스케일이 중첩된다

### 웨이퍼에서 Feature까지

반도체의 공간적 변동도 여러 스케일에서 동시에 발생한다.

**웨이퍼 레벨(300mm)** — 가장 큰 스케일이다. 스핀 코팅의 Center-Edge 두께 차이, 식각과 CMP의 에지 효과, 핫플레이트의 온도 분포가 이 스케일의 변동을 만든다. 3.7장의 웨이퍼맵 패턴(Edge, Center, Ring)이 이 스케일의 현상이다.

**필드 레벨(26×33mm)** — 스캐너의 노광 필드 크기다. 렌즈 수차, 스캔 방향에 따른 효과, 마스크 오차가 필드 내에서의 CD/Overlay 변동을 만든다. 2.10장의 Intra-field Overlay가 이 스케일이다.

**다이 레벨(수 mm)** — 패턴 밀도(Loading Effect)에 의한 변동이다. 밀집한 패턴 영역과 고립된 패턴 영역에서 식각 속도가 다르고, CMP에서의 연마 속도도 다르다. 2.7장의 OPC가 이 스케일의 보정을 담당한다.

**Feature 레벨(수십 nm)** — 가장 작은 스케일이다. 2.14장에서 다룬 EUV의 확률적 결함(Shot Noise에 의한 LER/LWR)이 이 스케일의 변동이며, 개별 Feature의 확률론적 행동은 결정론적 모델로는 접근할 수 없다.

### 공간 상관의 활용


![공간 보간(Kriging) 시각화 — 측정점에서 전체 웨이퍼 맵으로](/content/images/03_09/kriging_spatial_interpolation.png)

인접한 다이의 CD/Overlay는 서로 상관된다 — 가까운 다이일수록 비슷한 값을 갖는 경향이 있다. 이 **공간 상관(Spatial Correlation)**을 활용하면, 소수의 측정 포인트에서 전체 웨이퍼의 분포를 **보간(Interpolation)**할 수 있다.

**Kriging / Gaussian Process** — 측정된 포인트에서 미측정 포인트의 값을 공간적으로 보간하면서, **예측의 불확실성**까지 함께 제공한다. 5개 사이트에서 측정한 CD로 웨이퍼 전체 CD 맵을 추정하고, 추정의 불확실성이 큰 영역(에지, 측정 포인트에서 먼 곳)은 추가 계측을 권고하는 식이다.

**Zernike Polynomial** — 3.7장에서 언급한 기법으로, 원형 웨이퍼의 공간 변동을 직교 다항식으로 분해하여 Tilt, Defocus, Astigmatism 등의 성분을 독립적으로 정량화한다. 물리적 의미가 명확하여 해석성이 우수하다.

**2D CNN** — 웨이퍼맵을 이미지로 처리하여 공간 패턴을 학습한다. 3.7장에서 상세히 다뤘다.

2.10장에서 Overlay 변동을 **Inter-Field**(웨이퍼 레벨)와 **Intra-Field**(필드 레벨)로 분리하여 각각 다른 보정 메커니즘에 매핑했는데, 이것이 바로 공간 스케일을 분리하여 구조를 반영한 모델링의 전형적 예다.

---

## 계층 구조: 팹에서 다이까지의 중첩

### 반도체의 자연스러운 계층

반도체 데이터는 자연스러운 **중첩 계층(Nested Hierarchy)**을 갖는다.

```
팹 (Fab)
 └── 공정 영역 (Bay)
      └── 장비 (Equipment)
           └── 챔버 (Chamber)
                └── 로트 (Lot, 25장)
                     └── 웨이퍼 (Wafer)
                          └── 필드 (Field/Die, ~500개)
                               └── 사이트 (Site, ~4개/필드)
```

같은 로트의 웨이퍼들은 같은 장비를 거치므로 서로 유사하고, 같은 장비에서 처리된 로트들도 장비 특성을 공유한다. 이 **그룹 내 유사성(Within-Group Similarity)**을 무시하면 — 예를 들어 모든 웨이퍼를 독립적으로 취급하면 — 장비 효과나 로트 효과를 놓치고, 모델의 잔차에 구조적 패턴이 남게 된다.

### 변동 분해: 어디에 개선을 집중할 것인가


![Variance Decomposition — 계층별 CD 변동 기여도 파이 차트](/content/images/03_09/variance_decomposition_pie.png)

CD의 전체 변동(Total Variance)을 계층별로 분해할 수 있다.

```
Total Variance = σ²_Equipment + σ²_Chamber + σ²_Lot + σ²_Wafer + σ²_Field + σ²_Random
```

이 분해가 실전적으로 중요한 이유 — 각 성분의 기여도가 **개선 노력의 방향**을 결정하기 때문이다. σ²_Equipment가 전체의 40%를 차지하면 장비 간 매칭(Chamber Matching)에 집중해야 하고, σ²_Wafer가 크면 코팅이나 PEB 등 웨이퍼 내 균일도 개선에, σ²_Field가 크면 렌즈 수차 보정이나 마스크 품질 개선에 투자해야 한다. 이 분해 없이 "전체 CD 변동을 줄이겠다"는 목표를 세우면, 제한된 엔지니어링 리소스가 분산되어 효과가 희석된다.

### 혼합 효과 모델: 계층을 수학적으로 반영한다

**Mixed Effects Model(혼합 효과 모델)**은 계층 구조에 자연스럽게 적합한 통계 모델이다.

```
CD = β₀ + β₁·Dose + β₂·PEB_Temp + u_Equipment + u_Chamber + u_Lot + ε
```

β₀, β₁, β₂는 **Fixed Effect**(고정 효과)로 공정 조건(Dose, PEB 온도 등)의 체계적 영향을 나타낸다. u_Equipment, u_Chamber, u_Lot은 **Random Effect**(랜덤 효과)로 각 계층의 랜덤 변동을 나타내며, 각 장비/챔버/로트가 평균에서 얼마나 벗어나는지를 학습한다. ε는 나머지 설명되지 않는 잔차다.

Mixed Effects Model은 반도체 AI에서 아직 충분히 활용되지 않는 강력한 도구다. 여러분이 NLP에서 Hierarchical Attention이나 Multi-Level Embedding에 익숙하다면, Mixed Effects Model은 그것의 통계적 고전 버전이라 이해하면 된다.

---

## 반도체 데이터의 추가 특성: 네 가지 ML 도전

구조적 특성 외에도, 반도체 데이터에는 ML에 공통적으로 도전적인 네 가지 특성이 있다.

**클래스 불균형(Class Imbalance)** — 수율이 90%이면 불량 다이는 10%, 특정 결함 유형은 0.1% 미만이다. 불균형 비율이 1:100~1:10,000에 이르며, SMOTE, Focal Loss, Cost-Sensitive Learning이 표준 대응이다.

**레이블 비용(Labeling Cost)** — 계측이 비싸고 느리므로 레이블(실제 CD/OVL 값)이 부족하다. 전체 웨이퍼의 5~10%만 레이블이 있다. Semi-Supervised Learning, Active Learning, VM(3.6장)이 이 문제의 해결책이다.

**도메인 전이(Domain Shift)** — 새 제품, 새 장비, PM 후, 소재 배치 변경 시 데이터 분포가 변한다. Transfer Learning, Domain Adaptation, Incremental Learning으로 대응한다.

**인과관계 vs 상관관계** — 3.5장에서 강조했듯이, APC 보정은 **인과관계**에 기반해야 안전하다. 공정 데이터에는 변수 간 강한 상관관계가 넘쳐나지만, 상관은 인과가 아니다. Causal Inference 기법과 물리 모델-ML 하이브리드 접근이 이 문제를 다룬다.

---

## SMILE 플랫폼의 데이터 모델링 원칙

이 챕터의 내용을 SMILE 플랫폼 개발에 적용할 때 권장하는 다섯 가지 원칙을 정리한다.

**구조 존중** — 시계열/공간/계층 구조를 단순 테이블로 펼치지 않는다. 구조에 맞는 모델(시계열 → LSTM, 공간 → CNN/Kriging, 계층 → Mixed Effects)을 선택한다.

**물리 기반 피처** — Rayleigh 방정식(해상도 = k₁λ/NA), Overlay 선형 모델(Translation/Rotation/Magnification), Dose-CD 관계 등 물리 지식을 피처 엔지니어링에 활용한다. 순수 데이터 드리븐보다 물리 기반 피처가 일반화 성능이 우수하다.

**해석 가능성 우선** — 블랙박스보다 현장 엔지니어가 이해하고 신뢰하여 **실제로 채택**될 수 있는 모델을 우선한다. SHAP, Feature Importance, Partial Dependence Plot으로 해석성을 확보한다.

**적응성** — 공정 변화에 자동 적응하는 재학습 파이프라인이 내장되어야 한다. 정적 모델은 반도체 환경에서 수 주 내에 열화한다.

**안전 가드** — 3.5장에서 강조한 Safety Guard를 모든 모델 출력에 적용한다. 모델 출력 범위 제한(Clamping), 이상 입력 감지(RI/GSI), 이상 시 Fallback 메커니즘(EWMA로 되돌리기 등)이 필수다.

---

## Part 3을 마치며

Part 3 "수율과 공정 제어" 전 9챕터에서, 반도체 경제학의 핵심인 **수율**(3.1)에서 시작하여, **결함** 검사와 분류(3.2), **SPC**(3.3)와 **FDC**(3.4)로 공정과 장비를 감시하고, **APC**(3.5)로 자동 보정하며, **VM**(3.6)으로 측정 없이 예측하고, **웨이퍼맵**(3.7)으로 공간 패턴을 읽으며, 이 모든 것을 가능하게 하는 **데이터 인프라**(3.8)와 데이터의 **고유한 구조적 특성**(3.9)까지 다뤘다.

다음 Part 4 "AI/ML 실전"에서는 이 데이터와 시스템을 활용하여 **실제로 AI 모델을 만들고, 검증하고, 배포하는 방법**을 다룬다.

---

## 핵심 정리

반도체 공정 데이터는 **시계열, 공간, 계층**의 세 구조가 동시에 중첩된 다중 구조 데이터다. **시계열**은 밀리초~월 단위의 다섯 가지 스케일에서 동시에 변동하며, 비정상성(Non-Stationarity)이 근본 문제이므로 적응형 모델이 필수다. **공간**은 웨이퍼→필드→다이→Feature의 네 스케일이 중첩되며, Kriging/CNN/Zernike로 공간 상관을 활용한다. **계층**(팹→장비→챔버→로트→웨이퍼→다이)은 Mixed Effects Model로 변동을 분해하여 개선 방향을 결정한다. SMILE 플랫폼의 데이터 모델링 5원칙은 **구조 존중, 물리 기반 피처, 해석 가능성 우선, 적응성, 안전 가드**다.

---

*다음 챕터: 4.1 반도체 AI의 문제 정의 — 회귀, 분류, 최적화*
